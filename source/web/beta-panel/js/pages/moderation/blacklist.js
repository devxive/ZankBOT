$(run=function(){socket.getDBTableValues('moderation_blacklist_get','blackList',function(results){let tableData=[];for(let i=0;i<results.length;i++){let json=JSON.parse(results[i].value);tableData.push([json.phrase,json.isRegex,json.timeout,json.message,json.banReason,$('<div/>',{'class':'btn-group'}).append($('<button/>',{'type':'button','class':'btn btn-xs btn-danger','style':'float: right','data-blacklist':results[i].key,'html':$('<i/>',{'class':'fa fa-trash'})})).append($('<button/>',{'type':'button','class':'btn btn-xs btn-warning','style':'float: right','data-blacklist':results[i].key,'html':$('<i/>',{'class':'fa fa-edit'})})).html()])}
if($.fn.DataTable.isDataTable('#blacklistTable')){$('#blacklistTable').DataTable().destroy();$('#blacklistTable').off()}
let table=$('#blacklistTable').DataTable({'searching':!0,'autoWidth':!1,'lengthChange':!1,'data':tableData,'columnDefs':[{'className':'default-table','orderable':!1,'targets':5},{'width':'35%','targets':0},{'width':'25%','targets':3},{'width':'25%','targets':4}],'columns':[{'title':'Blacklist'},{'title':'Regex'},{'title':'Timeout'},{'title':'Message'},{'title':'Reason'},{'title':'Actions'}]});table.on('click','.btn-danger',function(){let blacklist=$(this).data('blacklist'),row=$(this).parents('tr');socket.removeDBValue('moderation_blacklist_rm','blackList',blacklist,function(){socket.sendCommand('moderation_blacklist_rm_cmd','reloadmod',function(){table.row(row).remove().draw(!1);toastr.success('Successfully removed phrase from the blacklist!')})})});table.on('click','.btn-warning',function(){let blacklist=$(this).data('blacklist');socket.getDBValue('moderation_blacklist_edit_get','blackList',blacklist,function(e){e=JSON.parse(e.blackList);helpers.getAdvanceModal('blacklist-edit-modal','Edit Blacklist','Save',$('<form/>',{'role':'form'}).append(helpers.getTextAreaGroup('ban-phrase','text','Blacklist Phrase','',e.phrase,'Phrase, word, or regex that should be blacklisted.',!0).append(helpers.getCheckBox('is-regex',e.isRegex,'Regex','If the blacklist phrase should be using regex.'))).append(helpers.getInputGroup('timeout-banmsg','text','Timeout Message','',e.message,'Message said in chat when a user gets timed-out.').append(helpers.getCheckBox('timeout-message-toggle',e.isSilent,'Silent','If the warning message should be said or not.'))).append(helpers.getInputGroup('timeout-timeout-time','number','Timeout Duration','0',e.timeout,'How long in seconds the user gets timed-out for when using the phrase in chat. -1 will ban the user.')).append($('<div/>',{'class':'collapse','id':'advance-collapse','style':'margin-top: 10px;','html':$('<form/>',{'role':'form'}).append(helpers.getInputGroup('timeout-reason','text','Timeout Reason','',e.banReason,'Message shown to all moderators when the user gets timed-out.')).append($('<div/>',{'class':'form-group'}).append(helpers.getCheckBox('exclude-regulars',e.excludeRegulars,'Exclude Regulars','If regulars should be allowed to bypass this filter.').append(helpers.getCheckBox('exclude-subscribers',e.excludeSubscribers,'Exclude Subscribers','If subscribers should be allowed to bypass this filter.').attr('style','display: inline;'))))})),function(){let phrase=$('#ban-phrase'),isRegex=$('#is-regex').is(':checked'),banMsg=$('#timeout-banmsg'),isSilent=$('#timeout-message-toggle').is(':checked'),timeoutTime=$('#timeout-timeout-time'),timeoutMsg=$('#timeout-reason'),isReg=$('#exclude-regulars').is(':checked'),isSub=$('#exclude-subscribers').is(':checked');if(isRegex&&!phrase.val().startsWith('regex:')){phrase.val('regex:'+phrase.val())}
switch(!1){case helpers.handleInputString(phrase):case helpers.handleInputString(banMsg):case helpers.handleInputString(timeoutTime):case helpers.handleInputString(timeoutMsg):break;default:socket.removeDBValue('rm_moderation_blacklist','blackList',blacklist,function(){socket.updateDBValue('update_moderation_blacklist','blackList',phrase.val(),JSON.stringify({id:'panel_'+phrase.val(),timeout:timeoutTime.val(),isRegex:isRegex,phrase:phrase.val(),isSilent:isSilent,excludeRegulars:isReg,excludeSubscribers:isSub,message:banMsg.val(),banReason:timeoutMsg.val()}),function(){run();$('#blacklist-edit-modal').modal('hide');toastr.success('Successfully edited blacklist!')})})}}).modal('toggle')})})})});$(function(){$('#add-blacklist-button').on('click',function(){helpers.getAdvanceModal('blacklist-add-modal','Add Blacklist','Save',$('<form/>',{'role':'form'}).append(helpers.getTextAreaGroup('ban-phrase','text','Blacklist Phrase','Kappa 123','','Phrase, word, or regex that should be blacklisted.',!0).append(helpers.getCheckBox('is-regex',!1,'Regex','If the blacklist phrase should be using regex.'))).append(helpers.getInputGroup('timeout-banmsg','text','Timeout Message','','You were timed-out for using a blacklisted phrase.','Message said in chat when a user gets timed-out.').append(helpers.getCheckBox('timeout-message-toggle',!1,'Silent','If the warning message should be said or not.'))).append(helpers.getInputGroup('timeout-timeout-time','number','Timeout Duration','0','600','How long in seconds the user gets timed-out for when using the phrase in chat. -1 will ban the user.')).append($('<div/>',{'class':'collapse','id':'advance-collapse','style':'margin-top: 10px;','html':$('<form/>',{'role':'form'}).append(helpers.getInputGroup('timeout-reason','text','Timeout Reason','','Using a blacklisted phrase','Message shown to all moderators when the user gets timed-out.')).append($('<div/>',{'class':'form-group'}).append(helpers.getCheckBox('exclude-regulars',!1,'Exclude Regulars','If regulars should be allowed to bypass this filter.').append(helpers.getCheckBox('exclude-subscribers',!1,'Exclude Subscribers','If subscribers should be allowed to bypass this filter.').attr('style','display: inline;'))))})),function(){let phrase=$('#ban-phrase'),isRegex=$('#is-regex').is(':checked'),banMsg=$('#timeout-banmsg'),isSilent=$('#timeout-message-toggle').is(':checked'),timeoutTime=$('#timeout-timeout-time'),timeoutMsg=$('#timeout-reason'),isReg=$('#exclude-regulars').is(':checked'),isSub=$('#exclude-subscribers').is(':checked');if(isRegex&&!phrase.val().startsWith('regex:')){phrase.val('regex:'+phrase.val())}
switch(!1){case helpers.handleInputString(phrase):case helpers.handleInputString(banMsg):case helpers.handleInputString(timeoutTime):case helpers.handleInputString(timeoutMsg):break;default:socket.updateDBValue('add_moderation_blacklist','blackList',phrase.val(),JSON.stringify({id:'panel_'+phrase.val(),timeout:timeoutTime.val(),isRegex:isRegex,phrase:phrase.val(),isSilent:isSilent,excludeRegulars:isReg,excludeSubscribers:isSub,message:banMsg.val(),banReason:timeoutMsg.val()}),function(){run();$('#blacklist-add-modal').modal('hide');toastr.success('Successfully added blacklist!')})}}).modal('toggle')});window.location.hash='#'})